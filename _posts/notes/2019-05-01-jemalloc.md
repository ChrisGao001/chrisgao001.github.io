---
layout: post
category: cpp
title: jemalloc 资料待整理
tags: [gcc, malloc, c++]

---

{% include JB/setup %}

---

这里把搜集的一些资料列举一下，后续做整理



- 官网<http://jemalloc.net/>

- nedmalloc<https://www.nedprod.com/programs/portable/nedmalloc/>

- tcmalloc和jemalloc比较<https://stackoverflow.com/questions/7852731/c-memory-allocation-mechanism-performance-comparison-tcmalloc-vs-jemalloc>

  结论放这里

  > If I remember correctly, the main difference was with multi-threaded projects.
  >
  > Both libraries try to de-contention memory acquire by having threads pick the memory from different caches, but they have different strategies:
  >
  > - `jemalloc` (used by Facebook) maintains a cache per thread
  > - `tcmalloc` (from Google) maintains a pool of caches, and threads develop a "natural" affinity for a cache, but may change
  >
  > This led, once again if I remember correctly, to an important difference in term of thread management.
  >
  > - `jemalloc` is faster if threads are static, for example using pools
  > - `tcmalloc` is faster when threads are created/destructed
  >
  > There is also the problem that since `jemalloc` spin new caches to accommodate new thread ids, having a sudden spike of threads will leave you with (mostly) empty caches in the subsequent calm phase.
  >
  > As a result, I would recommend `tcmalloc` in the general case, and reserve `jemalloc` for very specific usages (low variation on the number of threads during the lifetime of the application)

- ruby使用各种malloc的benchmark，有点参考价值<http://engineering.appfolio.com/appfolio-engineering/2018/2/1/benchmarking-rubys-heap-malloc-tcmalloc-jemalloc>

- repo <https://github.com/jemalloc/jemalloc> wiki值得看下

- 一个使用例子 https://www.jianshu.com/p/5fd2b42cbf3d

- 这是另一个测试，不过HN上有人说测得不合理<http://ithare.com/testing-memory-allocators-ptmalloc2-tcmalloc-hoard-jemalloc-while-trying-to-simulate-real-world-loads/>

  - 反对的声音<https://news.ycombinator.com/item?id=17457699>
  - 测试的脚本和程序<https://github.com/node-dot-cpp/alloc-test>

- jemalloc设计者的博客，很多文章。是个狠人<http://branchtaken.net/blog/2008/07/25/treaps-versus-red-black-trees.html>

- glibc malloc的调优文档<https://www.gnu.org/software/libc/manual/html_node/Memory-Allocation-Tunables.html>

- 理解glibc malloc <https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/>

- <https://www.facebook.com/notes/facebook-engineering/scalable-memory-allocation-using-jemalloc/480222803919>

- 论文<https://people.freebsd.org/~jasone/jemalloc/bsdcan2006/jemalloc.pdf>

- malloc 概论 必读<http://blog.reverberate.org/2009/02/one-malloc-to-rule-them-all.html>



### contact

Any advice mailto:wanghenshui@qq.com, thanks! 

Pulling a [issue](https://github.com/wanghenshui/wanghenshui.github.io/issues/new) is fine! I can get noticed from email.

看到这里或许你有建议或者疑问或者指出我的错误，我的邮箱wanghenshui@qq.com 先谢指教。或者到博客上提[issue](https://github.com/wanghenshui/wanghenshui.github.io/issues/new) 我能收到邮件提醒。