<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="一个简单的博客，争取每周都记录一点东西（已经打脸好几次了。。）邮箱 wangqw2ee@gmail.com">
<meta property="og:type" content="website">
<meta property="og:title" content="王很水">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="王很水">
<meta property="og:description" content="一个简单的博客，争取每周都记录一点东西（已经打脸好几次了。。）邮箱 wangqw2ee@gmail.com">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="王很水">
<meta name="twitter:description" content="一个简单的博客，争取每周都记录一点东西（已经打脸好几次了。。）邮箱 wangqw2ee@gmail.com">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>王很水</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  















  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">王很水</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">菜鸟程序员笔记</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/20/advanced-metaprogramming-in-classic-c-part1-prerequisites-chapter1-templates/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王很水">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img3.doubanio.com/icon/ul61740133-22.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王很水">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/20/advanced-metaprogramming-in-classic-c-part1-prerequisites-chapter1-templates/" itemprop="url">advanced_metaprogramming_in_classic_c++_part1_prerequisites_chapter1_templates</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-20T18:21:47+08:00">
                2017-06-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##典型c++高级元编程</p>
<h3 id="第一部分-预备知识-include"><a href="#第一部分-预备知识-include" class="headerlink" title="第一部分 预备知识 #include "></a>第一部分 预备知识 #include <prerequisites\></prerequisites\></h3><hr>
<p>//!个人有疑问的地方以及个人简介会加//? //!<br>//!翻译中可能会有不准的地方，我是结合上下文猜的。不准就不准吧因为水平不到位</p>
<ul>
<li>1.0 模板<br>-<br>编程是通过与其中的一台机器交谈来向计算机教授某些东西的过程共同语言。 越接近机器，就越不自然。每种语言都有自己的表现力。 对于任何给定的概念，各种语言的实现有不同的复杂度。在汇编中，我们必须给予非常丰富的描述，（显得不可读）c++的优势就在于在足够接近机器底层的同时又能有优美的表达，C++允许程序员用不同的风格来表达相同的概念，并且更加自然。<br>接下来深入了解c++模板系统的细节。</li>
</ul>
<p>下面是一个代码块</p>
<blockquote>
<p>double x = sq(3.14);</p>
</blockquote>
<p>sq是什么？<br>sq可以是宏</p>
<blockquote>
<p>#define sq(x) ((x)*(x))</p>
</blockquote>
<p>可以是一个函数</p>
<blockquote>
<p>double sq(double x) {return x*x;}</p>
</blockquote>
<p>可以是一个模板函数</p>
<blockquote>
<p>template <typename t\=""> </typename></p>
<p>inline T sq(const T&amp; x){ return x*x; }</p>
</blockquote>
<p>一个类型（没有实例）//函数对象</p>
<pre><code>class sq
{
    double s_;   
public:
    sq(double x):s_(x*x)
    {}
    operator double() const
    {
        return s_;
    }
};
</code></pre><p>或者一个全局变量</p>
<pre><code>class sq_t
{
public:
    typedef double value_type;
    value_tupe operator() (double x)
    {
        return x*x;
    }
};
const sq_t sq = sq_t();
</code></pre><p>不管如何实现，你看到后在脑海中肯定有一个实现，不过脑海中的实现和现实中的实现是不一样的，如果sq是一个类，放在函数模板中可能会有错误的推导结果</p>
<pre><code>template &lt;typename T&gt; void f(T x);

f(cos(3.14)); //实例化f&lt;double&gt;
f(sq(3.14)); //实例化f&lt;sq&gt;？
</code></pre><p>不仅如此，你还要考虑到各种数据类型被sq平方时在实现上要尽可能的高效，不同的实现有不同的效果</p>
<pre><code>std::vector&lt;double&gt; v;
std::transform(v.begin(),v.end(),v.begin(),sq);
</code></pre><p>速度瓶颈在sq的实现上。（宏会报错）</p>
<p>###模板元编程TMP的意义在于</p>
<ul>
<li>所见即所得，不必思考背后的实现</li>
<li>效率最高</li>
<li>“自适应”//?自洽？，与其余程序融合，可移植性强</li>
</ul>
<p>“自适应”意味着移植性强，不拘泥于编译器实现，不受约束，sq数据从一个抽象基类中继承出来可不满足 自洽自适应。<br>c++模板真正强大的地方在于类型//不变量<br>考虑两个表达式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">double x1 = (-b + sqrt(b\*b - 4\*a\*c))/(2\*a);</div><div class="line"></div><div class="line">double x2 = (-b + sqrt(sq(b) - 4\*a\*c))/(2\*a);</div></pre></td></tr></table></figure>
<p>模板的参数计算与类型推导都在编译期间完成，运行时不会有消耗。如果sq实现的好的话第二行要比第一行快且可读性强一些</p>
<p>用sq更优雅</p>
<ul>
<li>代码可读性强/逻辑自证</li>
<li>没有运行负担</li>
<li>最佳优化</li>
</ul>
<p>事实上在模板基础上可以轻松加上特化</p>
<pre><code>template &lt;&gt;
inline double sq(const double &amp; x)
{
    //here ,use any special algorithm you have
}
</code></pre><ul>
<li><p>1.1. C++ 模板<br>-<br>典型的c++模板，函数模板和类模板//备注：当前c++还支持其他模板，但都可以看做它们的扩展<br>只要你提供了满足条件的参数，在编译期间模板展开就可以了。<br>一个函数模板可以推导函数，一个类模板可以展开成类，TMP的要点可以总结为</p>
</li>
<li><p>你可以利用类模板在编译期完成计算。</p>
</li>
<li>函数模板可以自动推导他们的参数类型</li>
</ul>
<p>两种模板都需要把参数列表放在尖括号里。可以是类型或者是整数和指针<br>//备注 理论上所有整数类型都可以，枚举/bool/typedef/连编译器提供的类型都支持(__int64 MSVC)<br>//    指向全局函数/成员函数的指针也允许，指向变量的指针可能会有限制。在Chapter 11会有讨论<br>//!当然我能不能翻译到哪里就不好说了 </p>
<p>参数也可以有默认值//! 谁不知道啊</p>
<p><strong>模板可以理解成一个元函数，将参数映射成函数或类</strong></p>
<p>比如 sq</p>
<pre><code>template &lt;typename T&gt;
T sq(const T&amp; x);
</code></pre><p> T -&gt; T(*) (const T*)</p>
<p>同样的，类也是一个映射，比如 T -&gt;  basic_string<t><br>通过类的模板偏特化来具化元函数，你可以有一个普通的模板和一堆偏特化，它们有没有内容都可以。<br>定义的时候，类型就是形参，实例化的时候，类型就是实参。<br>当你向模板提供了实参， 作为元函数//！映射，模板就被实例化，然后生成代码，编译器再将模板生成的代码生成机器码</t></p>
<p>要明白不同的实参产生不同的实例，即使形参看起来差不多，double和const double实例化的效果可是没有相关性的。</p>
<p>当使用函数模板，编译器会弄明白所有的形参，我们可以理解成形参绑定在模板形参上。</p>
<pre><code>template &lt;typename T&gt;
T sq(const T&amp; x) { return x*x; }
double pi = 3.14;
sq(pi); // the compiler &quot;binds&quot; double to T
double x = sq(3.14); // ok: the compiler deduces that T is double
double x = sq&lt;double&gt;(3.14); // this is legal, but less than ideal
</code></pre><p> 所有的模板实参都是编译期常数</p>
<ul>
<li>类型形参可以接受任何类型//!只要是类型</li>
<li>非类型形参由最佳转换原则自动推导</li>
</ul>
<p>一个典型错误例子</p>
<pre><code>template &lt;int N&gt;
class SomeClass{};

int main()
{
    const int A = rand();
    SomeClass&lt;A&gt; s; //error

    static const int B = 2;
    SomeClass&lt;C&gt; s; //fine
}
</code></pre><p>模板中常量写法的最佳实践是 static const [[integer type]] name = value;<br>//!指的应该不是现代c++,是classic C++</p>
<p>当然，局部变量，static可以省略。不过这个并没有什么坏处，更清晰一些//!不必强求</p>
<p>传递到模板中的实参可以在编译期计算出结果，有效地整数运算都会在编译期得到结果。<br>//!换句话说，无效的运算都会在编译期被捕捉到而不是放在运行时崩一脸</p>
<ul>
<li>除以0会导致编译错误</li>
<li>禁止函数调用</li>
<li>生成代码中的非整数/指针类型都是不可移植的。//特指浮点型，可以通过整型除法替代</li>
</ul>
<p>SomeClass&lt;(27+56<em>5) % 4&gt; s1;<br>SomeClass&lt;sizeof(void</em> ) *CHAR_BIT&gt;</p>
<p>除以0的错误的前提是模板整体都是常量</p>
<pre><code>template &lt;int N&gt;
struct tricky
{
    int f(int i =0)
    { return i/N;} //not a constant
};

int main()
{
    tricky&lt;0&gt; t;
    return t.f();
}

waring: potential divide by 0;
</code></pre><p>改成N/N ，是常数之后就会报错了 实例化N为0或者0/0都会报错</p>
<p>更确切一点，编译期常量包括</p>
<ul>
<li>整型字面量 </li>
<li>sizeof，类似sizeof的得到整型结果的操作// <strong>alignof</strong></li>
<li>非类型模板形参 在上下文中就是模板wrapper //!原文为”outer” template<br>  template <int n=""><br>  class AnotherClass<br>  {<pre><code>SomeClass&lt;N&gt; _m;
</code></pre>  };</int></li>
<li><p>static 整型常数<br>  template <int n,int="" k=""><br>  struct NK<br>  {</int></p>
<pre><code>static const int PRODUCT = N*K;
</code></pre><p>  };</p>
<p>  SomeClass<nk<10,12>::PRODUCT &gt; s1;</nk<10,12></p>
</li>
<li>某些宏 <strong>LINE</strong><br>  SomeClass<__line__> s1;<br>//备注，一般没人这么用，通常用来自动生成枚举/实现断言</__line__></li>
</ul>
<p>模板形参可以依赖其他形参</p>
<pre><code>template&lt;typename T, int (*FUNC)(T)&gt;
class X{};

template&lt;typename T,T VALUE    &gt;
class Y{};

Y&lt;int,7&gt; y1;
Y&lt;double,3&gt; y2;//error  常数3没有这种double类型
</code></pre><p>类（模板类）也可以有模板成员函数</p>
<pre><code>struct math
{
    template &lt;typename T&gt;
    T sq(T x) const {return x*x;}
};

template &lt;typename T&gt;
struct _math{
    template &lt;typename _T&gt;//备注 T和_T区分避免被外面的给掩了
    static T product(T x, _T y){return x*y;}
};

double A = math().sq(3.14);
double B = _math&lt;double&gt;().product(3.14,5);
</code></pre><ul>
<li>1.1.1 Typename</li>
<li></li>
</ul>
<p>这个关键字用来</p>
<ol>
<li>声明模板形参，替代class歧义</li>
<li>告诉编译器如果不能识别出来，那它就是类型名</li>
</ol>
<p>举一个编译器不识别的例子</p>
<pre><code>template&lt;typename T&gt;
struct MyClass{
    typedef double Y;
    typedef T Type;
};

template&lt;&gt;
struct MyClass&lt;int&gt;{
    static const int Y = 314;
    typedef int Type;
}; 


int Q = 8;

template &lt;typename T&gt;
void SomeFunc(){
    MyClass&lt;T&gt;::Y * Q;
    //    这行代表一个Q的指向double的指针？还是314乘8？
}
</code></pre><p>Y是依赖名字，因为它依赖一个未知的参数T<br>直接或间接的依赖于一个位置的参数的变量都是依赖名字，都应该明确的用typename说明</p>
<p>//！这解决了我的一个疑问，之前遇到但是没有深究，我太菜了。见<a href="https://github.com/jieyaren/100k/blob/master/cppcook/pad.cpp" target="_blank" rel="external">代码和注释</a></p>
<pre><code>template &lt;typename X&gt;
class AnoterClass{
    MyClass&lt;X&gt;::Type t1_;//error
    typename MyClass&lt;X&gt;::Type t2_;//ok 
    MyClass&lt;double&gt;::Type t3_; //ok
};
</code></pre><p><strong>要明白上面这个例子中,第一个必须有typename，第三个不能有typename</strong></p>
<pre><code>template &lt;typename X&gt;
class AnotherClass{
    typename MyClass&lt;X&gt;::Y member1_;//ok 但是X是int不会编译
    typename MyClass&lt;double&gt;::Y member2_;//error
};
</code></pre><p>当声明了一个没有类型的模板形参时，需要typename引入依赖名字//!来推导出类型</p>
<pre><code>template &lt;typename T,typename T::type N&gt;
struct SomeClass{};

struct S1{
    typedef int type;
};

SomeClass&lt;S1,3&gt; x;
</code></pre><p>//!接下来这段不好翻译<br>对于类型T1::T2如果实例化中发现是没有类型的，需要加上typename，等待后面实例化<br>直接上代码<br>    tmeplate <typename t=""><br>    struct B{<br>        static const int N = sizeof(A<t>::X);<br>        //应该是sizeof(typename A…)<br>    };<br>直到实例化，B认为应该调用sizeof在没有类型的参数上，当然啦sizeof也会自己推导出来，所以代码没错，如果X是一个类型，这个代码也是合法的//!后面偏特化<br>见代码<br>    template <typename t=""><br>    struct A{<br>        static const int X = 7;<br>    };</typename></t></typename></p>
<pre><code>template &lt;&gt;
struct A&lt;char&gt;{
    typedef double X;
};
</code></pre><p>上面的例子没有覆盖一些阴暗的角落，有兴趣请点击这个阴暗的<a href="http://www.open-std.org/jtc1/sc22/wg21/docs/cwg_defects.html#666" target="_blank" rel="external">连接</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/20/Writing-Bug-Free-C-Code-Chapter-2-Know-Your-Environment/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王很水">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img3.doubanio.com/icon/ul61740133-22.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王很水">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/20/Writing-Bug-Free-C-Code-Chapter-2-Know-Your-Environment/" itemprop="url">Writing_Bug_Free_C_Code_Chapter_2_Know_Your_Environment</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-19T19:06:24Z">
                2017-06-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#####这已经不是翻译了，这就是笔记了。</p>
<p>##chapter 2： 了解你的工作环境<br>//blahblahblah(具体内容是了解你工作环境中的功能，特性)<br>    在你的工作范围内尽可能成为专家<br> 接下来讨论所有工作环境中遇到的问题</p>
<p>###2.1 C语言<br>无论你用啥编译器你都得彻底了解C语言工作环境</p>
<p>#####2.1.1 数组操作符[]<br>//blahblahblahblah具体内容是数组操作符的功能，和指针的关系，咱认为是个陋习但是掌握还是不难的，随便翻一本C语言书都有的<br>// K&amp;R §A7.3.1 </p>
<p>#####2.1.2 结构体指针操作符 -&gt;<br>//  K&amp;R §A7.3.3 </p>
<p>#####2.1.3 编译警告等级调高<br>// 这里具体指vs编译器，涉及到gcc就是-Wall 不多言</p>
<p>#####2.1.4 编译时断言设计 ComplierAssert()<br>    能放在编译期检测出来的bug就不要放在运行时</p>
<p>#####2.1.5 变量声明<br>cdecl</p>
<p>#####2.1.6 typedef</p>
<p>#####2.1.7 命名空间 </p>
<p>#####2.1.8 代码段变量<br>//与编译器实现有关，没什么意义。只是个访问权限的区别</p>
<p>#####2.1.9 相邻字符串</p>
<p>#####2.1.10 多参数…</p>
<p>#####2.1.11 函数调用约定</p>
<p>#####2.1.12 代码生成汇编<br>//以上两条都预编译器相关，基本没有用</p>
<p>#####2.1.13 悬挂else问题</p>
<p>#####2.1.14 strncpy 空间踩踏</p>
<p>#####2.1.15 switch中default写对<br>你拼错编译器会解析成labal<br>//应该会有警告的，21世纪了朋友，这个应该是不对的<br>//这特么都什么经验</p>
<p>#####2.1.16 逻辑运算与短路原则</p>
<p>#####2.1.17 摩根定律<br>//数电中的布尔电路章节内容，基本功了。<br>以上就是复习了一下C语言</p>
<p>###2.2 c预处理器</p>
<p>#####2.2.1 宏以及宏可能遇到的问题<br>作用域以及原子性</p>
<p>#####2.2.2 写有作用域的宏<br>do {}while(0)</p>
<p>#####2.2.3 宏中的条件语句<br>为了避免悬挂else这种可能遇到的问题 直接匹配上就好了。</p>
<pre><code>#define ODS(s) if (!bDebugging) {} else OutputDebugString(#s)
</code></pre><p>#####2.2.4 宏像语句一样正常的使用，用分号或者语句块结尾</p>
<pre><code>#define WinAssert(exp) if (!(exp)) {AssertError;} else
</code></pre><p>#####2.2.5 循环宏<br>//不建议这么写，这样是上古语法了。LOOP（）ENDLOOP太二了</p>
<p>#####2.2.6 数量宏<br>就是用宏把sizeof封装起来，经常在数组里见到</p>
<pre><code>#define NUMSTATICELS(pArray) (sizeof(pArray)/sizeof(*pArray))
</code></pre><p>#####2.2.7 预处理运算符#<br>字符串化和拼接技术</p>
<p>#####2.2.8 字符匹配<br>和编译器实现有关。这都二十一世纪了，这段可以去掉了</p>
<p>#####2.2.9 预处理器命令操纵预处理命令<br>宏开关</p>
<p>#####以上也是C语言回顾 主要是一些奇技淫巧</p>
<p>###2.3 编程难题<br>主要是一些实现上的坑</p>
<p>#####2.3.1 2的平方 宏</p>
<pre><code>#define ISPOWER2(x) (!((x)&amp;((x)-1)))
</code></pre><p>位运算。见Hacker’s delight</p>
<p>#####2.3.2 整数运算快<br>这与浮点数的设计有关，可以见MIT公开课编程范式 C语言部分</p>
<p>#####2.3.3 交换两个数不用第三个变量<br>就是著名的坑跌异或异或异或。没有意义。会溢出（当然用三个变量也有溢出的可能）</p>
<p>#####2.3.4 异或抵消锯齿？没看懂这部分<br><a href="http://www.duckware.com/bugfreec/chapter2.html#windows" target="_blank" rel="external">http://www.duckware.com/bugfreec/chapter2.html#windows</a></p>
<p>#####2.3.5 ~0 可移植性强于0xffff</p>
<p>#####2.3.6 y = -x 问题 补码</p>
<p>#####2.3.7 1和2 的补码</p>
<p>Two’s complement negation as a macro</p>
<pre><code>#define NEGATE(x) (((x)^~0)+1)
</code></pre><p>###2.4 总结<br>个人总结<br>注意多参数的问题，快忘没了<br>宏的几个trick<br>还有2.3.4没看懂</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/14/Writing-Bug-Free-C-code-chapter-1-Understand-Why-Bugs-Exist/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王很水">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img3.doubanio.com/icon/ul61740133-22.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王很水">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/14/Writing-Bug-Free-C-code-chapter-1-Understand-Why-Bugs-Exist/" itemprop="url">Writing Bug Free C code chapter 1 Understand Why Bugs Exist</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-13T18:26:31Z">
                2017-06-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>######本翻译仅供参考/博客凑数/多数翻译是意译,拿不准的部分会加英语原文</p>
<h2 id="Chapter-1-Understand-Why-Bugs-Exist-理解为什么有bug"><a href="#Chapter-1-Understand-Why-Bugs-Exist-理解为什么有bug" class="headerlink" title="Chapter 1: Understand Why Bugs Exist/理解为什么有bug"></a>Chapter 1: Understand Why Bugs Exist/理解为什么有bug</h2><p>在软件开发迭代中为啥老是有bug悄悄溜进来？花费时间来理解为什么bug存在是写出bug-free代码的第一步。第二步则是采取行动制定策略去减少问题/检测问题。更重要的是要让整个团队明白这些新的策略。</p>
<p>笔者的一个好朋友工作在一个特别的公司，会对他写的代码和模块使用运行时参数校验（run-time parameter validation）。这是一个好主意，但这种强制的做法可能会使其他程序员不太情愿。有一天朋友修改了一点旧代码，然后他加上了参数校验。他测试了他的代码然后就传到代码库了，几周之后这个代码调用老代码（一年前的）就会显示参数错误了。但是有些程序员想把这个参数校验去掉。他们认为有错误日志打印，不可能是老代码有问题，肯定是新加的参数校验错了。</p>
<p>这就是个极端的例子，但也足够说明在一个编程项目中必须让团队中每个人理解这种策略施行。</p>
<p>####1.1 小项目 vs. 大项目</p>
<p>如果你需要写一个hex dump工具 （就叫它DUMP）,这个程序需要接收命令行上一个你想显示的文件名字作为参数，能写出一个没有bug的代码吗？或许是的，因为这个项目很小，定义良好且隔离没有什么交互</p>
<p>因此如果你被要求写一个项目（叫ALPHA),一个你们公司集中为其他公司携的项目。这个项目需要几百上千行代码而且已经有十个程序员已经在这个项目上工作了。交付日期马上就到了，公司需要你的聪明才智，你认为可以马上跳进这个团队并且写出新的代码并且不引入bug？我不能，要是没有方法策略来捕捉错误的话任何新手都会引入bug。</p>
<p>思考一下你现在处理的最大的项目，有多少头文件，并且头文件里都有什么？有多少源代码文件，并且里面都有什么？你处理DUMP这种小工具毫无问题，那为啥你处理这个大项目就这么难呢？为啥大项目不像十个一百个小项目那样简单？</p>
<pre><code>编程原则必须新手友好，新手进入项目不至于引入新bug
</code></pre><p>咱们研究研究你的小项目。由几个头文件和实现文件组成，头文件有函数原型，数据结构声明，宏定义，typedef定义等，你啥都知道，因为文件足够少，你能处理掉，现在，把它乘十乘百，突然这个项目就变得不可管理了。</p>
<p>你的头文件里有太多东西要管理，这个项目需要支持，你增加人数处理这个项目让它更快完成，但是这只会加重问题，因为现在有更多的人向头文件中加入信息且其他人需要了解，这就是所有大项目都会陷入的一个恶性循环。</p>
<p>####1.2 头文件里太多数据结构</p>
<p>大项目有一个明显的问题信息太多是需要花一段时间来熟悉数据结构。如果能减少这些信息，这个过程可能会简单，因为你需要了解的数据结构少了。</p>
<p>根本问题是头文件里面放了太多的信息，主要贡献者就是数据结构声明。当你开始一个项目，你在头文件里放几个声明，项目进行中，你就越放越多。等你反应过来已经是一团乱麻了。你的实现文件里面有数据结构的<br>全部（The majority of your source files have knowledge of the data structures and directly reference elements from the structures.）</p>
<pre><code>需要减少数据结构的方法
</code></pre><p>考虑如果你改动多个数据结构。就得把所有用到的地方都得重新编译一边。（Making changes in an environment where many data structures directly refer to other data structures becomes, at best, a headache. Consider what happens when you change a data structure. This change forces you to recompile every source file that directly, or more importantly indirectly, refers to the changed data structure. This happens when a source file refers to a data structure that refers to a data structure that refers to the changed data structure. A change to the data structure may force you to modify some code, possibly in multiple source files. ）</p>
<p>在第四节用类来解决这个问题</p>
<p>####1.3 技巧与规模无关</p>
<pre><code>你的方法应该是融洽的，项目规模无关
</code></pre><p>比如说一个程序员joe制定了一个规则，所有的数据声明都得放在头文件里，这样所有的实现文件都能直接访问，这佯为他赢得了速度优势，他的产品也更高级一些。</p>
<p>这样可能在他产品的第一版有用，当他的产品的规模越来越大，达到临界点，大量的公共公共数据声明导致无法管理。他的工作有麻烦了。这个策略在小规模的项目上工作的很好，但是在大规模的项目中遗憾的失败。优秀的小项目早晚会变成大项目。</p>
<p>要明白你的编程方法应该是融洽的，在大小项目上都行得通的。</p>
<p>####1.4 太多全局变量</p>
<p>全局变量应该尽量避免。这种用法在大的应用上有局限。当一个较大的应用变的越来越大，全局变量的数目变的越来越多。等你反应过来，你的全局变量已经多到你管不过来了。</p>
<p>当你用到全局变量的时候，想想为什么你需要直接访问全局变量。把一个模块函数调用放在变量那里效果不是一样（Would a function call to the module where the variable is defined work just as well? ）大多数情况都可以替代。如果一个全局变量被修改了，你需要问你自己这个全局变量的影响，如果被一个函数调用代替，那就把问题交给函数处理</p>
<pre><code>暴漏给多个文件的变量应该避免
</code></pre><p>有些全局变量影响不大，无论项目多大，全局变量都不应该过多。</p>
<p>####1.5 依靠debugger</p>
<pre><code>在减少bug的技巧中debugger最有效,但是这通常是你的最后手段，出现了这种问题，你前面的bug-free技巧方法已经出现问题了。
</code></pre><p>不要过分依赖debugger来捕捉bug，要用你自己之前设定的规则与技巧。</p>
<p>####1.6 解决现象，而不是问题</p>
<p>比如你在你的代码里遇到了个bug，//这段没什么意思不翻译了</p>
<pre><code>改bug时要改掉隐藏在bug背后的原因不要仅仅改掉bug本身，
</code></pre><p>一个高级点的例子就是内存泄露，大多数情况内存泄露不会直接造成问题，直到内存耗尽为止，内存耗尽就是结果，你最终找到了导致内存耗尽的那一行代码并且回收了这块内存，看上去bug已经fixed了，但是并没有。</p>
<p>隐藏的内存泄露问题仍然在你的代码里。你需要一个堆管理模块来告诉你哪里内存泄露了，而不是自己花费时间来追踪内存泄露。彻底额的解决这个问题，堆管理模块会告诉你具体到细节，哪里出现了泄露。第五节会仔细讨论这个问题</p>
<p>####1.7 不可维护的代码</p>
<p>通常遇到维护他人写好的代码，修改bug或者添加新功能，我不知道你怎么想，对我来说这不是什么愉悦的体验，通常代码不好理解需要花费时间来琢磨代码流程究竟是什么。</p>
<pre><code>坚持写别人能理解的代码
    //正在翻译的我不是这么认为的，我感觉需要有恰当的注释
</code></pre><p>总之明白最后有人会看你的代码，所以尽量写的不要太模糊。除非注释清晰文档明确<br>//果然作者也是这么想的。</p>
<p>####1.8 别用微软的内置调试器</p>
<p>不细说</p>
<p>####1.9 总结</p>
<ol>
<li>The first step in writing bug-free code is to understand why bugs exist. The second step is to take action. That is what this book is all about.</li>
<li>Programming methodologies that are developed to prevent and detect bugs must work equally well for both small and large programming projects.</li>
<li>A technique that helps eliminate data structure declarations from include files needs to be found. Doing so will allow programmers to come up to speed on an existing project much quicker.</li>
<li>Global variables that are known to more than one source file should be avoided. Global variables make it hard to maintain a project.</li>
<li>Debuggers should be used only as a last resort. Having to resort to a debugger means that your programming methodologies used to detect bugs have failed.</li>
<li>When you fix a bug, make sure you are really fixing the underlying cause of the bug and not just the symptom of the bug. Ask yourself how many times you have fixed the same type of bug.</li>
<li>Strive to write code that is straightforward and easily understandable by others. Avoid writing code that pulls a lot of tricks.</li>
<li>Finally, make sure that you use the Windows debug kernel all the time. It contains extra error checking that can automatically detect certain types of bugs that go undetected in the retail release of Windows</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/12/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王很水">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://img3.doubanio.com/icon/ul61740133-22.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王很水">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/12/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-12T07:57:29Z">
                2017-06-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://img3.doubanio.com/icon/ul61740133-22.jpg"
               alt="王很水" />
          <p class="site-author-name" itemprop="name">王很水</p>
           
              <p class="site-description motion-element" itemprop="description">一个简单的博客，争取每周都记录一点东西（已经打脸好几次了。。）邮箱 wangqw2ee@gmail.com</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://www.douban.com/people/jieyaren/" target="_blank" title="豆瓣">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  豆瓣
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/jieyaren" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/u/bf236b694fbb" target="_blank" title="简书">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  简书
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.cnblogs.com/jieyaren/" target="_blank" title="博客园">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  博客园
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">王很水</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

  

</body>
</html>
